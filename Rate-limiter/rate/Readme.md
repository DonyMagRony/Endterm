# Ограничение запросов с использованием Redis и алгоритма Sliding Window

## Описание
Данный проект реализует механизм **ограничения скорости запросов (rate limiting)** с использованием **Redis** и алгоритма **скользящего окна (sliding window)**. Решение обеспечивает точный контроль над количеством запросов в заданный временной интервал, минимизируя скачки нагрузки и обеспечивая равномерное распределение трафика.

---

## Алгоритм Sliding Window
Алгоритм скользящего окна позволяет:
- Учитывать каждый запрос в пределах текущего временного интервала.
- Автоматически удалять запросы, выходящие за границы окна.
- Предотвращать резкие всплески трафика, обеспечивая равномерное распределение нагрузки.

> **Преимущество**: В отличие от фиксированного окна, скользящее окно более гибкое и точное, так как не допускает скачков в начале нового временного интервала.

---

## Почему выбран Redis
- **Скорость и производительность**: Redis работает в оперативной памяти, что обеспечивает минимальную задержку. Lua-скриптыи позволяет выполнять атомарные операции для эффективного управления запросами в реальном времени.
- **Масштабируемость**: Redis легко масштабируется при увеличении нагрузки. Несколько сервисов могут использовать одну базу данных.
- **Атомарность операций**: Lua-скрипты гарантируют выполнение операций как единой транзакции, предотвращая гонки данных при параллельных запросах.

---

## Почему выбран алгоритм Sliding Window
- **Гибкость и точность**: Позволяет задавать лимит запросов и адаптировать его под любой временной интервал.
- **Равномерное распределение нагрузки**: Учет каждого запроса в пределах окна предотвращает резкие скачки трафика.
- **Простота интеграции**: Эффективно работает с отсортированными множествами Redis, упрощая реализацию.

---

## Интеграция с FastAPI
- **Middleware**: Реализовано через `RateLimitMiddleware`, которое применяется ко всем входящим запросам, обеспечивая единообразное ограничение скорости. Middleware добавляет заголовки:
  - `X-RateLimit-Limit` — максимальный лимит запросов.
  - `X-RateLimit-Remaining` — оставшееся количество запросов.
  - `X-RateLimit-Reset` — время сброса лимита.
- **Dependency Injection**: Используется функция `rate_limit_dependency` для гибкого ограничения доступа к определенным endpoint’ам (например, `/api/sensitive`).

---

## Реализация
1. **Хранение данных в Redis**:
   - Каждому запросу присваивается уникальный ключ.
   - Данные хранятся в отсортированном множестве Redis с метками времени для отслеживания запросов в окне.
2. **Проверка лимита**:
   - Lua-скрипт проверяет количество запросов за заданный период.
   - При превышении лимита запрос отклоняется с HTTP-кодом `429 Too Many Requests`.
3. **Локальный кэш**:
   - Для снижения нагрузки на Redis используется локальный кэш на уровне сервиса, временно хранящий результаты проверки лимита.
4. **Middleware и Dependency Injection**:
   - Централизованное управление через middleware.
   - Гибкость в применении ограничений к конкретным endpoint’ам.

---

## Установка и запуск
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
